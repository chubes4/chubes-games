(()=>{"use strict";var e,t={181:(e,t,r)=>{const n=window.React;var a=r(338);const s=window.wp.element,o=window.wp.apiFetch;var l=r.n(o);const c=async(e,t,r)=>{try{return await l()({path:"/chubes-games/v1/scores",method:"POST",data:{game:e,score:t,player_name:r}})}catch(e){return console.error("Error submitting score:",e),null}},i=async e=>{try{const t=(await l()({path:"/chubes-games/v1/scores"})).findIndex(t=>t.id===e);return-1!==t?`You are rank #${t+1}!`:"Your score is on the board!"}catch(e){return console.error("Error getting rank:",e),"Score submitted!"}},u=(0,s.forwardRef)((e,t)=>{const{className:r,...a}=e,s=r?`chubes-game-window ${r}`:"chubes-game-window";return(0,n.createElement)("div",{...a,className:s,ref:t},e.children)}),f=({score:e,onPlayAgain:t,loggedInUserData:r})=>{const[a,o]=(0,s.useState)("PROCESSING"),[u,f]=(0,s.useState)(null),[m,h]=(0,s.useState)("");return(0,s.useEffect)(()=>{(async()=>{const t=await(async e=>{try{const t=await l()({path:"/chubes-games/v1/scores"});return t.length<100||e>t[t.length-1].player_score}catch(e){return console.error("Error checking high score:",e),!1}})(e);if(!t)return f({message:"Thanks for playing!"}),void o("SHOW_MESSAGE");if(r?.displayName){const t=r.displayName,n=await c("snake",e,t);if(n?.new_score_id){const e=await i(n.new_score_id);f({message:`High Score! ${e}`})}else f({message:"Could not save high score."});o("SHOW_MESSAGE")}else o("SHOW_FORM")})()},[e,r]),"PROCESSING"===a?(0,n.createElement)("div",{className:"game-overlay"},(0,n.createElement)("div",{className:"results-screen"},(0,n.createElement)("h2",null,"Game Over!"),(0,n.createElement)("p",null,"Final Score: ",e),(0,n.createElement)("p",null,"Checking high scores..."))):(0,n.createElement)("div",{className:"game-overlay"},(0,n.createElement)("div",{className:"results-screen"},(0,n.createElement)("h2",null,"Game Over!"),(0,n.createElement)("p",null,"Final Score: ",e),"SHOW_FORM"===a?(0,n.createElement)("form",{onSubmit:async t=>{t.preventDefault(),o("PROCESSING");const r=""===m.trim()?"Guest":m,n=await c("snake",e,r);if(n?.new_score_id){const e=await i(n.new_score_id);f({message:`High Score! ${e}`})}else f({message:"Could not save high score."});o("SHOW_MESSAGE")},className:"highscore-form"},(0,n.createElement)("p",null,"New High Score! Enter your name:"),(0,n.createElement)("div",{className:"form-row"},(0,n.createElement)("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"Guest",autoFocus:!0}),(0,n.createElement)("button",{type:"submit"},"Submit"))):(0,n.createElement)(n.Fragment,null,u&&(0,n.createElement)("p",null,u.message),(0,n.createElement)("button",{onClick:t},"Play Again"))))},m=(e,t,r,n,a={})=>{let s;do{s={x:Math.floor(Math.random()*r.x),y:Math.floor(Math.random()*r.y)}}while(e.some(e=>e.x===s.x&&e.y===s.y)||t.some(e=>e.position.x===s.x&&e.position.y===s.y));let o=0;return void 0!==a.specificTier?o=a.specificTier:void 0!==a.maxTier&&(o=Math.floor(Math.random()*(a.maxTier+1))),{position:s,tier:n[Math.min(o,n.length-1)]}},h=()=>{const e={x:32,y:24},t=[{x:16,y:12},{x:16,y:13}],r={x:0,y:-1},a=[{points:1,color:"#ff6b6b"},{points:2,color:"#feca57"},{points:3,color:"#e67e22"},{points:4,color:"#48dbfb"},{points:5,color:"#8e44ad"}],o=[5,15,30,50],[l,c]=(0,s.useState)("IDLE"),[i,h]=(0,s.useState)(t),[d,y]=(0,s.useState)(r),[g,p]=(0,s.useState)([]),[v,E]=(0,s.useState)(0),[w,S]=(0,s.useState)(150),[b,x]=(0,s.useState)(0),[O,R]=(0,s.useState)(0),[k,M]=(0,s.useState)(0),N=window.chubesGamesData?.userData,_=(0,s.useRef)(null),A=(0,s.useRef)(null),G=()=>{h(t),y(r),E(0),S(150),p([m(t,[],e,a,{specificTier:0})]),x(0),c("PLAYING")};return(0,s.useEffect)(()=>{if("PLAYING"!==l)return;const t=setInterval(()=>{h(r=>{const n=[...r],s={...n[0]};if(s.x+=d.x,s.y+=d.y,s.x<0&&(s.x=31),s.x>=32&&(s.x=0),s.y<0&&(s.y=23),s.y>=24&&(s.y=0),n.slice(1).some(e=>e.x===s.x&&e.y===s.y))return clearInterval(t),c("GAME_OVER"),r;n.unshift(s);let l=null;const i=g.filter(e=>e.position.x!==s.x||e.position.y!==s.y||(l=e,!1));if(l){const t=v+l.tier.points;E(t);let r=b;b<o.length&&t>=o[b]&&(r++,x(e=>e+1)),i.push(m(n,i,e,a,{maxTier:r})),p(i)}else n.pop();return n})},w);return()=>clearInterval(t)},[l,d,w,v,g,b]),(0,s.useEffect)(()=>{if("PLAYING"!==l)return;const e=150-1*(i.length-t.length);S(Math.max(50,e))},[i.length,l]),(0,s.useEffect)(()=>{const e=A.current;if(!e)return;const t=new ResizeObserver(()=>{R(e.clientWidth),M(e.clientHeight)});return t.observe(e),()=>t.disconnect()},[]),(0,s.useEffect)(()=>{const e=_.current;if(!e)return;if(e.width=O,e.height=k,0===O||0===k)return;const t=e.getContext("2d"),r=O/32,n=k/24,a=Math.min(r,n),s=32*a,o=24*a,l=(O-s)/2,c=(k-o)/2;t.fillStyle="#000",t.fillRect(0,0,O,k),t.fillStyle="#2d3436",t.fillRect(l,c,s,o),t.fillStyle="#00b894";const u=.5;i.forEach(({x:e,y:r})=>{t.fillRect(l+e*a+u,c+r*a+u,a-1,a-1)});const f=i[0];t.fillStyle="#000000";const m=a-1,h=m/5,y=l+f.x*a+u,p=c+f.y*a+u;if(-1===d.y){const e=p+h,r=y+h,n=y+m-2*h;t.fillRect(r,e,h,h),t.fillRect(n,e,h,h)}else if(1===d.y){const e=p+m-2*h,r=y+h,n=y+m-2*h;t.fillRect(r,e,h,h),t.fillRect(n,e,h,h)}else if(-1===d.x){const e=y+h,r=p+h,n=p+m-2*h;t.fillRect(e,r,h,h),t.fillRect(e,n,h,h)}else{const e=y+m-2*h,r=p+h,n=p+m-2*h;t.fillRect(e,r,h,h),t.fillRect(e,n,h,h)}g.forEach(e=>{t.fillStyle=e.tier.color,t.beginPath(),t.arc(l+(e.position.x+.5)*a,c+(e.position.y+.5)*a,a/2.2,0,2*Math.PI),t.fill()});const E=.9*a;t.fillStyle="white",t.font=`${E}px sans-serif`,t.textAlign="left",t.textBaseline="top",t.fillText(`Score: ${v}`,l+10,c+10)},[i,g,d,v,O,k]),(0,s.useEffect)(()=>{const e=e=>{if("PLAYING"!==l)return;let t;switch(e.key){case"ArrowUp":e.preventDefault(),0===d.y&&(t={x:0,y:-1});break;case"ArrowDown":e.preventDefault(),0===d.y&&(t={x:0,y:1});break;case"ArrowLeft":e.preventDefault(),0===d.x&&(t={x:-1,y:0});break;case"ArrowRight":e.preventDefault(),0===d.x&&(t={x:1,y:0});break;default:return}t&&y(t)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[l,d]),(0,n.createElement)(u,{className:"wp-block-chubes-games-snake",ref:A},"IDLE"===l&&(0,n.createElement)("div",{className:"game-overlay"},(0,n.createElement)("button",{className:"chubes-games-button",onClick:G},"Play")),"GAME_OVER"===l&&(0,n.createElement)(f,{score:v,onPlayAgain:G,loggedInUserData:N}),(0,n.createElement)("canvas",{ref:_}))};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-chubes-games-snake").forEach(e=>{(0,a.H)(e).render((0,n.createElement)(s.StrictMode,null,(0,n.createElement)(h,null)))})})},338:(e,t,r)=>{var n=r(795);t.H=n.createRoot,n.hydrateRoot},795:e=>{e.exports=window.ReactDOM}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,r,a,s)=>{if(!r){var o=1/0;for(u=0;u<e.length;u++){for(var[r,a,s]=e[u],l=!0,c=0;c<r.length;c++)(!1&s||o>=s)&&Object.keys(n.O).every(e=>n.O[e](r[c]))?r.splice(c--,1):(l=!1,s<o&&(o=s));if(l){e.splice(u--,1);var i=a();void 0!==i&&(t=i)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[r,a,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={319:0,336:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var a,s,[o,l,c]=r,i=0;if(o.some(t=>0!==e[t])){for(a in l)n.o(l,a)&&(n.m[a]=l[a]);if(c)var u=c(n)}for(t&&t(r);i<o.length;i++)s=o[i],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},r=globalThis.webpackChunkchubes_games=globalThis.webpackChunkchubes_games||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var a=n.O(void 0,[336],()=>n(181));a=n.O(a)})();