(()=>{"use strict";var e,t={181:(e,t,r)=>{const n=window.React,a=window.wp.element,s=window.wp.apiFetch;var l=r.n(s);const o=async(e,t,r)=>{try{return await l()({path:"/chubes-games/v1/scores",method:"POST",data:{game:e,score:t,player_name:r}})}catch(e){return console.error("Error submitting score:",e),null}},c=async e=>{try{const t=(await l()({path:"/chubes-games/v1/scores"})).findIndex(t=>t.id===e);return-1!==t?`You are rank #${t+1}!`:"Your score is on the board!"}catch(e){return console.error("Error getting rank:",e),"Score submitted!"}},i=(0,a.forwardRef)((e,t)=>{const{className:r,...a}=e,s=r?`chubes-game-window ${r}`:"chubes-game-window";return(0,n.createElement)("div",{...a,className:s,ref:t},e.children)}),u=({score:e,onPlayAgain:t,loggedInUserData:r})=>{const[s,i]=(0,a.useState)("PROCESSING"),[u,f]=(0,a.useState)(null),[m,h]=(0,a.useState)("");return(0,a.useEffect)(()=>{(async()=>{const t=await(async e=>{try{const t=await l()({path:"/chubes-games/v1/scores"});return t.length<100||e>t[t.length-1].player_score}catch(e){return console.error("Error checking high score:",e),!1}})(e);if(!t)return f({message:"Thanks for playing!"}),void i("SHOW_MESSAGE");if(r?.displayName){const t=r.displayName,n=await o("snake",e,t);if(n?.new_score_id){const e=await c(n.new_score_id);f({message:`High Score! ${e}`})}else f({message:"Could not save high score."});i("SHOW_MESSAGE")}else i("SHOW_FORM")})()},[e,r]),"PROCESSING"===s?(0,n.createElement)("div",{className:"game-overlay"},(0,n.createElement)("div",{className:"results-screen"},(0,n.createElement)("h2",null,"Game Over!"),(0,n.createElement)("p",null,"Final Score: ",e),(0,n.createElement)("p",null,"Checking high scores..."))):(0,n.createElement)("div",{className:"game-overlay"},(0,n.createElement)("div",{className:"results-screen"},(0,n.createElement)("h2",null,"Game Over!"),(0,n.createElement)("p",null,"Final Score: ",e),"SHOW_FORM"===s?(0,n.createElement)("form",{onSubmit:async t=>{t.preventDefault(),i("PROCESSING");const r=""===m.trim()?"Guest":m,n=await o("snake",e,r);if(n?.new_score_id){const e=await c(n.new_score_id);f({message:`High Score! ${e}`})}else f({message:"Could not save high score."});i("SHOW_MESSAGE")},className:"highscore-form"},(0,n.createElement)("p",null,"New High Score! Enter your name:"),(0,n.createElement)("div",{className:"form-row"},(0,n.createElement)("input",{type:"text",value:m,onChange:e=>h(e.target.value),placeholder:"Guest",autoFocus:!0}),(0,n.createElement)("button",{type:"submit"},"Submit"))):(0,n.createElement)(n.Fragment,null,u&&(0,n.createElement)("p",null,u.message),(0,n.createElement)("button",{onClick:t},"Play Again"))))},f=(e,t,r,n,a={})=>{let s;do{s={x:Math.floor(Math.random()*r.x),y:Math.floor(Math.random()*r.y)}}while(e.some(e=>e.x===s.x&&e.y===s.y)||t.some(e=>e.position.x===s.x&&e.position.y===s.y));let l=0;return void 0!==a.specificTier?l=a.specificTier:void 0!==a.maxTier&&(l=Math.floor(Math.random()*(a.maxTier+1))),{position:s,tier:n[Math.min(l,n.length-1)]}},m=()=>{const e={x:32,y:24},t=[{x:16,y:12},{x:16,y:13}],r={x:0,y:-1},s=[{points:1,color:"#ff6b6b"},{points:2,color:"#feca57"},{points:3,color:"#e67e22"},{points:4,color:"#48dbfb"},{points:5,color:"#8e44ad"}],l=[5,15,30,50],[o,c]=(0,a.useState)("IDLE"),[m,h]=(0,a.useState)(t),[d,y]=(0,a.useState)(r),[g,p]=(0,a.useState)([]),[v,E]=(0,a.useState)(0),[w,b]=(0,a.useState)(150),[S,x]=(0,a.useState)(0),[O,k]=(0,a.useState)(0),[R,N]=(0,a.useState)(0),_=window.chubesGamesData?.userData,M=(0,a.useRef)(null),A=(0,a.useRef)(null),G=()=>{h(t),y(r),E(0),b(150),p([f(t,[],e,s,{specificTier:0})]),x(0),c("PLAYING")};return(0,a.useEffect)(()=>{if("PLAYING"!==o)return;const t=setInterval(()=>{h(r=>{const n=[...r],a={...n[0]};if(a.x+=d.x,a.y+=d.y,a.x<0&&(a.x=31),a.x>=32&&(a.x=0),a.y<0&&(a.y=23),a.y>=24&&(a.y=0),n.slice(1).some(e=>e.x===a.x&&e.y===a.y))return clearInterval(t),c("GAME_OVER"),r;n.unshift(a);let o=null;const i=g.filter(e=>e.position.x!==a.x||e.position.y!==a.y||(o=e,!1));if(o){const t=v+o.tier.points;E(t);let r=S;S<l.length&&t>=l[S]&&(r++,x(e=>e+1)),i.push(f(n,i,e,s,{maxTier:r})),p(i)}else n.pop();return n})},w);return()=>clearInterval(t)},[o,d,w,v,g,S]),(0,a.useEffect)(()=>{if("PLAYING"!==o)return;const e=150-1*(m.length-t.length);b(Math.max(50,e))},[m.length,o]),(0,a.useEffect)(()=>{const e=A.current;if(!e)return;const t=new ResizeObserver(()=>{k(e.clientWidth),N(e.clientHeight)});return t.observe(e),()=>t.disconnect()},[]),(0,a.useEffect)(()=>{const e=M.current;if(!e)return;if(e.width=O,e.height=R,0===O||0===R)return;const t=e.getContext("2d"),r=O/32,n=R/24,a=Math.min(r,n),s=32*a,l=24*a,o=(O-s)/2,c=(R-l)/2;t.fillStyle="#000",t.fillRect(0,0,O,R),t.fillStyle="#2d3436",t.fillRect(o,c,s,l),t.fillStyle="#00b894";const i=.5;m.forEach(({x:e,y:r})=>{t.fillRect(o+e*a+i,c+r*a+i,a-1,a-1)});const u=m[0];t.fillStyle="#000000";const f=a-1,h=f/5,y=o+u.x*a+i,p=c+u.y*a+i;if(-1===d.y){const e=p+h,r=y+h,n=y+f-2*h;t.fillRect(r,e,h,h),t.fillRect(n,e,h,h)}else if(1===d.y){const e=p+f-2*h,r=y+h,n=y+f-2*h;t.fillRect(r,e,h,h),t.fillRect(n,e,h,h)}else if(-1===d.x){const e=y+h,r=p+h,n=p+f-2*h;t.fillRect(e,r,h,h),t.fillRect(e,n,h,h)}else{const e=y+f-2*h,r=p+h,n=p+f-2*h;t.fillRect(e,r,h,h),t.fillRect(e,n,h,h)}g.forEach(e=>{t.fillStyle=e.tier.color,t.beginPath(),t.arc(o+(e.position.x+.5)*a,c+(e.position.y+.5)*a,a/2.2,0,2*Math.PI),t.fill()});const E=.9*a;t.fillStyle="white",t.font=`${E}px sans-serif`,t.textAlign="left",t.textBaseline="top",t.fillText(`Score: ${v}`,o+10,c+10)},[m,g,d,v,O,R]),(0,a.useEffect)(()=>{const e=e=>{if("PLAYING"!==o)return;let t;switch(e.key){case"ArrowUp":e.preventDefault(),0===d.y&&(t={x:0,y:-1});break;case"ArrowDown":e.preventDefault(),0===d.y&&(t={x:0,y:1});break;case"ArrowLeft":e.preventDefault(),0===d.x&&(t={x:-1,y:0});break;case"ArrowRight":e.preventDefault(),0===d.x&&(t={x:1,y:0});break;default:return}t&&y(t)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o,d]),(0,n.createElement)(i,{className:"wp-block-chubes-games-snake",ref:A},"IDLE"===o&&(0,n.createElement)("div",{className:"game-overlay"},(0,n.createElement)("button",{className:"chubes-games-button",onClick:G},"Play")),"GAME_OVER"===o&&(0,n.createElement)(u,{score:v,onPlayAgain:G,loggedInUserData:_}),(0,n.createElement)("canvas",{ref:M}))},h=e=>{e&&(0,a.render)((0,n.createElement)(m,null),e)};document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".wp-block-chubes-games-snake").forEach(h)})}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var s=r[e]={exports:{}};return t[e](s,s.exports,n),s.exports}n.m=t,e=[],n.O=(t,r,a,s)=>{if(!r){var l=1/0;for(u=0;u<e.length;u++){for(var[r,a,s]=e[u],o=!0,c=0;c<r.length;c++)(!1&s||l>=s)&&Object.keys(n.O).every(e=>n.O[e](r[c]))?r.splice(c--,1):(o=!1,s<l&&(l=s));if(o){e.splice(u--,1);var i=a();void 0!==i&&(t=i)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[r,a,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={319:0,336:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var a,s,[l,o,c]=r,i=0;if(l.some(t=>0!==e[t])){for(a in o)n.o(o,a)&&(n.m[a]=o[a]);if(c)var u=c(n)}for(t&&t(r);i<l.length;i++)s=l[i],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},r=globalThis.webpackChunkchubes_games=globalThis.webpackChunkchubes_games||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var a=n.O(void 0,[336],()=>n(181));a=n.O(a)})();