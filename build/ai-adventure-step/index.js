(()=>{"use strict";const e=window.React,t=window.wp.blocks,s=window.wp.blockEditor,a=window.wp.i18n,r=window.wp.element,n=window.wp.components,i=window.wp.data,o=JSON.parse('{"UU":"chubes-games/ai-adventure-step"}');(0,t.registerBlockType)(o.UU,{edit:({attributes:t,setAttributes:o,clientId:c})=>{const{stepPrompt:l,stepId:g,triggers:d}=t,p=(0,i.useSelect)(e=>{const{getBlocks:t}=e("core/block-editor"),s=t(),r=[];let n=-1;const i=s.find(e=>"chubes-games/ai-adventure"===e.name);i&&(i.innerBlocks.forEach((e,t)=>{e.innerBlocks.some(e=>e.clientId===c)&&(n=t)}),i.innerBlocks.forEach((e,t)=>{if(t<=n)return;if("chubes-games/ai-adventure-path"!==e.name)return;const s=e.innerBlocks[0];if(s&&"chubes-games/ai-adventure-step"===s.name){const a=e.attributes.label||`Path ${t+1}`,n="Step 1",i=s.attributes.stepId||s.clientId;r.push({value:i,label:`${a} → ${n}`})}}));const o=[{value:"",label:(0,a.__)("Select destination...","chubes-games")},{value:"end_game",label:(0,a.__)("🏁 End Game","chubes-games")}];return r.length>0&&o.push(...r),o},[c]);(0,r.useEffect)(()=>{g||o({stepId:c})},[c]);const h=(e,t,s)=>{const a=[...d];a[t][s]=e,o({triggers:a})};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(s.InspectorControls,null,(0,e.createElement)(n.PanelBody,{title:(0,a.__)("Story Triggers","chubes-games")},(0,e.createElement)("p",{className:"components-base-control__help"},(0,a.__)('Define semantic conditions that advance the story. Use descriptive phrases like "Player opens the chest" or "Player talks to the wizard".',"chubes-games")),d.map((t,s)=>(0,e.createElement)("div",{key:s,className:"trigger-item",style:{marginBottom:"20px",padding:"15px",border:"1px solid #ddd",borderRadius:"4px"}},(0,e.createElement)(n.TextareaControl,{label:(0,a.__)("Trigger Condition","chubes-games"),value:t.triggerPhrase,onChange:e=>h(e,s,"triggerPhrase"),placeholder:"e.g., Player decides to enter the cave",help:(0,a.__)("Describe the player action or decision that should trigger this path.","chubes-games"),rows:3}),(0,e.createElement)(n.SelectControl,{label:(0,a.__)("Destination","chubes-games"),value:t.destinationStep,onChange:e=>h(e,s,"destinationStep"),options:p,help:(0,a.__)("Where should the story go when this trigger is activated?","chubes-games")}),(0,e.createElement)(n.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=[...d];t.splice(e,1),o({triggers:t})})(s)},(0,a.__)("Remove Trigger","chubes-games")))),(0,e.createElement)(n.Button,{variant:"primary",onClick:()=>{const e=[...d,{triggerPhrase:"",destinationStep:""}];o({triggers:e})}},(0,a.__)("Add Story Trigger","chubes-games")))),(0,e.createElement)("div",{...(0,s.useBlockProps)()},(0,e.createElement)(s.RichText,{tagName:"p",onChange:e=>o({stepPrompt:e}),value:l,placeholder:(0,a.__)("Step Action: What is happening at this moment in the story?","chubes-games")})))},save:({attributes:t})=>{const{stepPrompt:a,label:r,stepId:n,triggers:i}=t,o=s.useBlockProps.save({"data-step-id":n,"data-triggers":JSON.stringify(i||[])});return(0,e.createElement)("div",{...o},r&&(0,e.createElement)(s.RichText.Content,{tagName:"h4",value:r}),a&&(0,e.createElement)(s.RichText.Content,{tagName:"p",value:a,className:"ai-adventure-step-prompt"}))}})})();