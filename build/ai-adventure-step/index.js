(()=>{"use strict";const e=window.React,t=window.wp.blocks,a=window.wp.blockEditor,s=window.wp.i18n,n=window.wp.element,r=window.wp.components,i=window.wp.data,l=JSON.parse('{"UU":"chubes-games/ai-adventure-step"}');(0,t.registerBlockType)(l.UU,{edit:({attributes:t,setAttributes:l,clientId:o})=>{const{stepPrompt:c,stepId:d,triggers:p}=t,g=(0,i.useSelect)(e=>{const{getBlocks:a}=e("core/block-editor"),n=a(),r=[];let i=null,l=null;const o=n.find(e=>"chubes-games/ai-adventure"===e.name);o&&o.innerBlocks.forEach((e,a)=>{if("chubes-games/ai-adventure-path"===e.name){const s=e.attributes.label||`Path ${a+1}`;e.innerBlocks.forEach((a,n)=>{if("chubes-games/ai-adventure-step"===a.name){const o=a.attributes.label||`Step ${n+1}`,c=a.attributes.stepId||a.clientId;c===t.stepId&&(i=e.clientId,l=n),r.push({value:c,label:`${s} â†’ ${o}`,pathId:e.clientId,stepIndex:n})}})}});const c=r.filter(e=>t.stepId!==e.value&&(e.pathId!==i||e.stepIndex>l)),d=[{value:"",label:(0,s.__)("Select destination...","chubes-games")},{value:"end_game",label:(0,s.__)("ðŸ End Game","chubes-games")}];return c.length>0?(d.push(...c),d):d.filter(e=>""===e.value||"end_game"===e.value)},[t.stepId]);(0,n.useEffect)(()=>{d||l({stepId:o})},[o]);const h=(e,t,a)=>{const s=[...p];s[t][a]=e,l({triggers:s})};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(a.InspectorControls,null,(0,e.createElement)(r.PanelBody,{title:(0,s.__)("Story Triggers","chubes-games")},(0,e.createElement)("p",{className:"components-base-control__help"},(0,s.__)('Define semantic conditions that advance the story. Use descriptive phrases like "Player opens the chest" or "Player talks to the wizard".',"chubes-games")),p.map((t,a)=>(0,e.createElement)("div",{key:a,className:"trigger-item",style:{marginBottom:"20px",padding:"15px",border:"1px solid #ddd",borderRadius:"4px"}},(0,e.createElement)(r.TextControl,{label:(0,s.__)("Trigger Condition","chubes-games"),value:t.triggerPhrase,onChange:e=>h(e,a,"triggerPhrase"),placeholder:"e.g., Player decides to enter the cave",help:(0,s.__)("Describe the player action or decision that should trigger this path.","chubes-games")}),(0,e.createElement)(r.SelectControl,{label:(0,s.__)("Destination","chubes-games"),value:t.destinationStep,onChange:e=>h(e,a,"destinationStep"),options:g,help:(0,s.__)("Where should the story go when this trigger is activated?","chubes-games")}),(0,e.createElement)(r.Button,{isLink:!0,isDestructive:!0,onClick:()=>(e=>{const t=[...p];t.splice(e,1),l({triggers:t})})(a)},(0,s.__)("Remove Trigger","chubes-games")))),(0,e.createElement)(r.Button,{variant:"primary",onClick:()=>{const e=[...p,{triggerPhrase:"",destinationStep:""}];l({triggers:e})}},(0,s.__)("Add Story Trigger","chubes-games")))),(0,e.createElement)("div",{...(0,a.useBlockProps)()},(0,e.createElement)(a.RichText,{tagName:"p",onChange:e=>l({stepPrompt:e}),value:c,placeholder:(0,s.__)("Step Action: What is happening at this moment in the story?","chubes-games")})))},save:({attributes:t})=>{const{stepPrompt:s,label:n,stepId:r,triggers:i}=t,l=a.useBlockProps.save({"data-step-id":r,"data-triggers":JSON.stringify(i||[])});return(0,e.createElement)("div",{...l},n&&(0,e.createElement)(a.RichText.Content,{tagName:"h4",value:n}),s&&(0,e.createElement)(a.RichText.Content,{tagName:"p",value:s,className:"ai-adventure-step-prompt"}))}})})();